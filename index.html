<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sagar's Birthday Reality Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body {
      margin: 0; padding: 0;
      min-height: 100vh;
      font-family: 'Segoe UI', sans-serif;
      background: #211e30;
      transition: background 0.7s;
    }
    body.shake { animation: shake 0.8s; }
    @keyframes shake {
      0%,100% { transform: translate(0,0);}
      10% { transform: translate(-10px, 2px);}
      20% { transform: translate(8px, -3px);}
      30% { transform: translate(-7px, 8px);}
      40% { transform: translate(10px, -8px);}
      50% { transform: translate(-8px, 4px);}
      60% { transform: translate(8px, -8px);}
      70% { transform: translate(-10px, 5px);}
      80% { transform: translate(7px, -3px);}
      90% { transform: translate(-7px, 5px);}
    }
    .container {
      max-width: 390px;
      margin: 5vh auto;
      background: #fff5;
      border-radius: 16px;
      box-shadow: 0 8px 32px #15102160;
      padding: 2.2em 1.3em 2em;
      text-align: center;
    }
    h1 {
      color: #ffd600;
      margin-bottom: 0.4em;
      text-shadow: 1px 2px 8px #0009;
    }
    form label { display:block; margin:1.2em 0 0.5em; font-weight:bold; color:#fff; }
    input, textarea {
      width: 90%; padding: 0.6em; border-radius: 7px;
      border: 1px solid #ccc; margin-bottom:1em;
      font-size:1em;
    }
    button {
      background: linear-gradient(90deg, #ff6a00, #ffd600 85%);
      border:none; padding: 0.8em 2.2em; border-radius: 8px;
      font-weight: bold; font-size: 1.1em; color: #222;
      cursor: pointer; margin-top:1em; box-shadow:0 2px 8px #0003;
    }
    .loading {
      font-size: 1.2em; color: #fff;
      animation: hue 2s infinite alternate;
      margin: 1.8em 0 0;
    }
    @keyframes hue { 100% { filter: hue-rotate(360deg); } }
    #result { display:none; }
    .glitch {
      color:#fff; font-size:2.1em; font-weight:bold;
      text-shadow: 1px 1px 6px #ff00f0, -2px -2px 12px #00fff0;
      animation: shake 1.5s infinite alternate;
      letter-spacing:0.03em;
      margin-bottom: 0.7em;
    }
    #ai-image {
      max-width: 95%; border-radius:16px; box-shadow: 0 6px 32px #222c;
      margin-bottom:1.5em; margin-top:0.6em;
    }
    #ai-story {
      font-size: 1.15em; color: #111; background:#fff6;
      border-radius: 8px; padding: 1.1em 0.9em; margin:0.8em 0;
      box-shadow: 0 2px 10px #fff2;
    }
    .confetti-canvas { position:fixed;top:0;left:0;width:100vw;height:100vh;pointer-events:none;z-index:99; }
    .spin-btn { background:#211e30;color:#ffd600;margin:0.8em 1em;font-size:1em; }
    .share-btn { background:#ffd600;color:#211e30;font-size:1em; }
  </style>
</head>
<body>
  <canvas class="confetti-canvas" id="confetti"></canvas>
  <div class="container" id="main">
    <h1>Wish Sagar a Happy Birthday! ðŸŽ‚</h1>
    <form id="wish-form">
      <label>Name:<input type="text" name="name" required></label>
      <label>Your Wish:<textarea name="message" required rows="3"></textarea></label>
      <button type="submit">Open the Birthday Portal!</button>
    </form>
    <div class="loading" id="loading" style="display:none;">Reality is shifting... ðŸŒ€</div>
    <div id="result">
      <div class="glitch" id="headline"></div>
      <img id="ai-image" />
      <div id="ai-story"></div>
      <button class="spin-btn" onclick="window.location.reload()">Spin Again!</button>
      <button class="share-btn" id="shareBtn">Share This!</button>
    </div>
  </div>
  <script>
    // Confetti effect, simple version:
    function launchConfetti() {
      for (let i = 0; i < 100; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.style.position = 'fixed';
          confetti.style.left = Math.random() * 100 + 'vw';
          confetti.style.top = '-4vh';
          confetti.style.width = confetti.style.height = Math.random() > 0.5 ? '14px':'8px';
          confetti.style.background = 'hsl('+(Math.random()*360)+',90%,60%)';
          confetti.style.borderRadius = Math.random() > 0.5 ? '60%':'100%';
          confetti.style.opacity = '0.95';
          confetti.style.transform = 'rotate('+(Math.random()*360)+'deg)';
          confetti.style.transition = 'top 1.4s cubic-bezier(.25,.76,.44,1.11)';
          confetti.style.zIndex = 999;
          document.body.appendChild(confetti);
          setTimeout(() => { confetti.style.top = (90 + Math.random()*10) + 'vh'; }, 10);
          setTimeout(() => { confetti.remove(); }, 1600);
        }, i*11);
      }
    }

    // Glitch/shake animation
    function shakePage() {
      document.body.classList.add('shake');
      setTimeout(()=>document.body.classList.remove('shake'), 900);
    }

    // Dynamic color shift
    function colorShift() {
      let hue = 0;
      let intv = setInterval(()=>{
        hue += 12;
        document.body.style.filter = `hue-rotate(${hue}deg)`;
        if (hue > 360) clearInterval(intv);
      }, 55);
      setTimeout(()=>{ document.body.style.filter = '' }, 2500);
    }

    // Handle the form
    document.getElementById('wish-form').addEventListener('submit', async function(e){
      e.preventDefault();
      document.getElementById('loading').style.display = '';
      shakePage();
      colorShift();
      // Send data to n8n webhook
      const formData = Object.fromEntries(new FormData(this).entries());
      const response = await fetch('https://n8n.budhathokisagar.com.np/webhook/wishme', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(formData)
      });
      let res = await response.json();

      // Animate result
      document.getElementById('loading').style.display = 'none';
      launchConfetti();
      shakePage();

      document.getElementById('headline').innerText = 'âš¡ Reality Shift Detected! âš¡';
      document.getElementById('ai-story').innerText = res.event;
      document.getElementById('ai-image').src = res.image;
      document.getElementById('result').style.display = '';
      document.getElementById('wish-form').style.display = 'none';

      // Share button (for modern browsers)
      document.getElementById('shareBtn').onclick = function() {
        if (navigator.share) {
          navigator.share({
            title: 'My Alternate Birthday Reality',
            text: `I just shifted reality wishing Sagar! Check out what happened:\n${res.event}`,
            url: window.location.href
          });
        } else {
          navigator.clipboard.writeText(`I just shifted reality wishing Sagar! ${res.event}\n${window.location.href}`);
          alert('Link copied! Share your new reality!');
        }
      };
    });
  </script>
</body>
</html>
