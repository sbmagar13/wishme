<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sagar’s Birthday Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body { background: #181325; min-height: 100vh; margin: 0; }
    .container { max-width: 400px; margin: 5vh auto; background: #fff3; border-radius: 14px; box-shadow:0 4px 40px #0007; padding: 2em 1em 1.5em; text-align:center;}
    h1 { color: #ffd600; }
    form label { display: block; margin: 1.2em 0 0.5em; color: #fff; }
    input, textarea { width: 92%; padding: 0.7em; border-radius: 8px; border: 1px solid #ccc; margin-bottom: 1.1em; }
    button { background: linear-gradient(90deg,#6a00ff,#ffd600 80%); color:#211e30; font-weight:bold; font-size:1.05em; border:none; border-radius:8px; padding:0.8em 2em; box-shadow:0 2px 10px #2224; cursor:pointer; }
    .loading { color:#fff; font-size:1.1em; margin:2em 0 0;}
    .result { display:none; margin-top:1em;}
    .crazy-msg { color:#ffd600; font-size:1.15em; margin-bottom:1.3em; font-weight:bold; }
    .art-img { max-width: 99%; border-radius:12px; box-shadow:0 2px 16px #0008; margin-bottom:1em; }
    .gallery-link { margin:1em auto 0.5em; display:inline-block; color:#6a00ff; background:#fff8; border-radius:8px; padding:0.3em 1em; text-decoration:none;}
    .spin-btn, .share-btn { margin:0.9em 0.6em 0; font-size:1em;}
  </style>
</head>
<body>
  <div class="container">
    <h1>Wish Sagar a Happy Birthday! 🎂</h1>
    <form id="wish-form">
      <label>Name:<input type="text" name="name" required></label>
      <label>Your Wish:<textarea name="message" required rows="3"></textarea></label>
      <button type="submit">Shift Reality!</button>
    </form>
    <div class="loading" id="loading" style="display:none;">Reality is shifting... 🌀</div>
    <div class="result" id="result">
      <div class="crazy-msg" id="crazyReply"></div>
      <img id="aiImage" class="art-img" />
      <a class="gallery-link" href="/gallery.html" target="_blank">🌈 Wall of Chaos</a>
      <div>
        <button class="spin-btn" onclick="window.location.reload()">Spin Again!</button>
        <button class="share-btn" id="shareBtn">Share This!</button>
      </div>
    </div>
  </div>
  <script>
    // Emoji rain for "prophecy" effects:
    function rainEmojis(emoji, count=32) {
      for (let i = 0; i < count; i++) {
        setTimeout(() => {
          const el = document.createElement('div');
          el.textContent = emoji;
          el.style.position = 'fixed';
          el.style.left = Math.random()*100 + 'vw';
          el.style.top = '-4vh';
          el.style.fontSize = (2 + Math.random()*2.2) + 'em';
          el.style.zIndex = 999;
          el.style.transition = 'top 2.1s cubic-bezier(.36,.97,.32,1.11)';
          document.body.appendChild(el);
          setTimeout(() => { el.style.top = (94 + Math.random()*4) + 'vh'; }, 18);
          setTimeout(() => { el.remove(); }, 2300 + Math.random()*500);
        }, i * 51);
      }
    }

    // Detect relevant emoji trigger from reply:
    function triggerEmojiRain(reply) {
      if(/momo|dumpling/i.test(reply)) rainEmojis('🥟');
      if(/goat|sheep/i.test(reply)) rainEmojis('🐐');
      if(/penguin/i.test(reply)) rainEmojis('🐧');
      if(/cake|birthday/i.test(reply)) rainEmojis('🍰');
      if(/rainbow|magic/i.test(reply)) rainEmojis('🌈');
      if(/balloon/i.test(reply)) rainEmojis('🎈');
      if(/party|confetti/i.test(reply)) rainEmojis('🎉');
      if(/chicken/i.test(reply)) rainEmojis('🐔');
      // ...add more as needed!
    }

    document.getElementById('wish-form').addEventListener('submit', async function(e){
      e.preventDefault();
      document.getElementById('loading').style.display = '';
      const formData = Object.fromEntries(new FormData(this).entries());
      try {
        const response = await fetch('https://n8n.budhathokisagar.com.np/webhook/wishme', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(formData)
        });
        if (!response.ok) throw new Error('AI server problem');
        const res = await response.json();

        // Hide loader, show result:
        document.getElementById('loading').style.display = 'none';
        document.getElementById('crazyReply').innerText = res.reply;
        document.getElementById('aiImage').src = res.image;
        document.getElementById('result').style.display = '';
        document.getElementById('wish-form').style.display = 'none';

        // Trigger emoji rain!
        triggerEmojiRain(res.reply);

        // Share button:
        document.getElementById('shareBtn').onclick = function() {
          if (navigator.share) {
            navigator.share({
              title: 'Sagar’s AI Birthday Wish Portal',
              text: `My Sagar Birthday Prophecy: ${res.reply}`,
              url: window.location.href
            });
          } else {
            navigator.clipboard.writeText(`Sagar Birthday Prophecy: ${res.reply}\n${window.location.href}`);
            alert('Link copied! Share your prophecy!');
          }
        };
      } catch(err) {
        document.getElementById('loading').style.display = 'none';
        alert('Our AI penguins tripped! Please try again in a moment.');
      }
    });
  </script>
</body>
</html>
